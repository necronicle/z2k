# Отчет об оптимизации стратегий DPI bypass

## Общая статистика

- **Исходное количество**: 880 стратегий
- **Оптимизированное количество**: 130 стратегий
- **Сокращение**: 750 стратегий (85.2%)

## Распределение по типам стратегий

| Тип стратегии | Количество | Описание |
|--------------|-----------|----------|
| **OOB (urp)** | 3 | Out-of-band data с различными urp значениями (0, 2, midsld) |
| **MULTIDISORDER** | 4 | Переупорядочивание пакетов на ключевых позициях |
| **MULTISPLIT** | 45 | Разбиение пакетов с различными TCP/IP параметрами |
| **FAKEDSPLIT** | 65 | Разбиение с поддельными пакетами - самая обширная группа |
| **HOSTFAKESPLIT** | 4 | Специализированное разбиение для Host header |
| **FAKEDDISORDER** | 8 | Комбинация поддельных пакетов и переупорядочивания |
| **TCPSEG** | 1 | TCP сегментация |

## Используемые техники обхода

### Топ техник (по частоте использования)

1. **IP TTL** (46 стратегий)
   - `ip_ttl=1` - поддельные пакеты с минимальным TTL
   - `ip_autottl=-1 до -5` - автоматический подбор TTL

2. **Fake TLS blob** (44 стратегии)
   - `blob=fake_default_tls` - стандартный TLS ClientHello
   - С модификациями: `tls_mod=rnd,dupsid,padencap`

3. **TCP MD5** (23 стратегии)
   - Добавление несуществующей TCP MD5 опции
   - Часто с `send:tcp_md5` для дополнительных пакетов

4. **TCP SEQ** (21 стратегия)
   - `tcp_seq=-3000` - отрицательное смещение
   - `tcp_seq=1000000` - большое положительное значение

5. **Zero blob** (15 стратегий)
   - `blob=0x00000000` - нулевые байты в поддельных пакетах

6. **TCP Timestamps** (14 стратегий)
   - `tcp_ts=-1000` - модификация временных меток
   - `tcp_ack=-66000:tcp_ts_up` - комбинация с ACK

7. **Bad Checksum** (13 стратегий)
   - `badsum` - намеренно неверная контрольная сумма

8. **TCP ACK** (8 стратегий)
   - `tcp_ack=-66000` - модификация ACK номера

9. **TLS Modification** (7 стратегий)
   - `tls_mod=rnd,dupsid,padencap` - различные модификации TLS

10. **TCP Flags** (3 стратегии)
    - `tcp_flags_unset=ACK`, `tcp_flags_set=SYN`

## Используемые позиции разбиения

### Числовые позиции
- **pos=2** (44 использования) - после 2 байтов
- **pos=1** (25 использований) - после 1 байта
- **pos=10** (1 использование) - специальная позиция

### SNI-относительные позиции
- **Составные позиции** (58 использований) - комбинации типа:
  - `pos=1,midsld` - множественные позиции
  - `pos=sniext+1` - после SNI extension
  - `pos=sniext+4` - со смещением
  - `pos=1,sniext+1,host+1,midsld-2,midsld,midsld+2,endhost-1`

### Специальные позиции
- **midsld** (14 использований) - середина домена второго уровня
- **host+1**, **endhost-1** - относительно Host header

## Критерии отбора

### 1. OOB стратегии
- ✅ Оставлены все 3 уникальные стратегии
- Каждая с уникальным urp значением

### 2. MULTIDISORDER
- ✅ Отобраны ключевые позиции: 1, 2, sniext+1, midsld
- ❌ Удалены дублирующиеся вариации

### 3. MULTISPLIT
- ✅ Отобраны представители каждой комбинации:
  - Позиция × TCP/IP параметр
  - Приоритет: базовые + tcp_md5 + tcp_seq + ip_ttl + timestamps
- ❌ Удалено 195 дублирующихся стратегий

### 4. FAKEDSPLIT (самая большая группа)
- ✅ Отобрано 65 из 366 стратегий
- Критерии:
  - Разнообразие позиций (2, 1, sniext+1, sniext+4, host+1, midsld)
  - Разнообразие техник (tcp_md5, tcp_seq, ip_ttl, tcp_timestamps, tcp_ack, tcp_flags)
  - Комбинации параметров
- ❌ Удалено 301 дублирующаяся стратегия

### 5. FAKE стратегии
- ✅ Отобрано по 1 представителю каждой уникальной комбинации
- Группировка по: blob × TCP/IP параметры
- ❌ Удалено 237 дублирующихся стратегий

## Уникальные особенности оптимизированного набора

### Комплексные стратегии
Сохранены стратегии с множественными этапами:
```
--lua-desync=fake:blob=0x00000000:tcp_seq=-3000:repeats=1
--lua-desync=fake:blob=fake_default_tls:tcp_seq=-3000:tls_mod=rnd,dupsid:repeats=1
--lua-desync=multisplit:pos=host+1
```

### AutoTTL варианты
Представлены стратегии с разными уровнями автоматического TTL:
- `ip_autottl=-1,3-20`
- `ip_autottl=-2,3-20`
- `ip_autottl=-3,3-20`
- `ip_autottl=-4,3-20`
- `ip_autottl=-5,3-20`

### Специализированные методы
- `syndata` - отправка данных в SYN пакете
- `tcpseg` - TCP сегментация с overlap
- `hostfakesplit` - оптимизированное разбиение для HTTP Host

## Рекомендации по использованию

1. **Для первичного тестирования**: начните с OOB и MULTIDISORDER стратегий (простые, но эффективные)

2. **Для упорного DPI**: используйте FAKEDSPLIT с ip_autottl (адаптивный подход)

3. **Для специфичных блокировок**: HOSTFAKESPLIT и FAKEDDISORDER

4. **Комплексный подход**: стратегии с несколькими этапами (fake + multisplit)

## Файлы

- **Исходный файл**: `strats_new2.txt` (880 стратегий)
- **Оптимизированный файл**: `strats_optimized.txt` (130 стратегий)
- **Скрипт оптимизации**: `optimize_strats.py`

## Результат

Создан компактный набор из **130 уникальных стратегий**, покрывающий все основные техники DPI bypass с максимальным разнообразием параметров и позиций. Сокращение на **85.2%** без потери функциональности.
